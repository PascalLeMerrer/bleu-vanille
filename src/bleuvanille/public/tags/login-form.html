<login-form>
  <form class="w40 center" onsubmit="{ login }">
    <label for="username" class="row mts mrs mls">Adresse email</label>
    <input name="username" type="email" class="row mrs mls login">
    <label for="password" class="row mts mrs mls">Mot de passe</label>
    <input name="password" type="password" class="row mrs mls login" value="xeCuf8CHapreNe=">
    <input id="connect" type="submit" value="Me connecter" class="row mts mls btn primary-btn"/>
  </form>

  <script>
  // Sends an authentication request to the server
  login() {
    var payload = 'email=' + this.username.value + ';password=' + this.password.value
    superagent.post('/users/login')
      .set('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8')
      .send(payload)
      .end(this.loginCallback)
  }

  // process connection request response
  loginCallback(err, response) {
    if(response.ok) {
      this.firstname = response.body.firstname
      this.lastname = response.body.lastname
      this.opts.bus.trigger('logged')
    } else {
      this.opts.bus.trigger('displayError', "Cette combinaison email / mot de passe est erron√©e.")
    }
    riot.update()
  }
  </script>
</login-form>
